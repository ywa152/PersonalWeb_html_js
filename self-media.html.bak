<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="不叫奥神的自媒体空间，分享技术教程与开发心得">
    <meta name="keywords" content="不叫奥神, 自媒体空间, 技术教程, 开发心得">
    <title>不叫奥神 - 自媒体空间</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- EmailJS 用于发送邮件 -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <!-- bcryptjs 用于密码加密 -->
    <script src="https://cdn.jsdelivr.net/npm/bcryptjs@2.4.3/dist/bcrypt.min.js"></script>
    <!-- 统一颜色配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF85A2',
                        secondary: '#FFB6C1',
                        accent: '#FF69B4',
                        light: '#FFF5F7',
                        dark: '#5A4B51'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .relax-bg {
                background: linear-gradient(180deg, #FFF5F7 0%, #FFFAFC 100%);
                min-height: 100vh;
            }
            .media-card {
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            }
            .media-card:hover {
                transform: translateY(-6px) scale(1.02);
            }
            .action-btn {
                position: relative;
                overflow: hidden;
                transition: all 0.3s ease;
            }
            .action-btn::after {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 150%;
                height: 150%;
                background: rgba(255,255,255,0.2);
                transform: translate(-50%, -50%) rotate(45deg);
                transition: all 0.6s ease;
            }
            .action-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 20px rgba(255,133,162,0.25);
            }
            .action-btn:hover::after {
                width: 0;
                height: 0;
            }
            .fullscreen-overlay {
                background: rgba(0,0,0,0.9);
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            .fullscreen-overlay.active {
                opacity: 1;
                visibility: visible;
            }
            .modal-backdrop {
                background: rgba(0,0,0,0.5);
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            .modal-backdrop.active {
                opacity: 1;
                visibility: visible;
            }
            .progress-bar {
                height: 4px;
                background: linear-gradient(90deg, #FF85A2 0%, #FF69B4 100%);
                width: 0%;
                transition: width 0.3s ease;
            }
            .error-message {
                color: #dc2626;
                font-size: 0.875rem;
                margin-top: 0.25rem;
                display: none;
            }
            .error-message.show {
                display: block;
            }
            .admin-badge {
                position: absolute;
                top: -4px;
                right: -4px;
                background: #FF69B4;
                color: white;
                font-size: 0.75rem;
                padding: 1px 6px;
                border-radius: 999px;
            }
            /* 隐藏用于处理视频封面的canvas和video元素 */
            #thumbnail-canvas, #thumbnail-video {
                display: none;
            }
        }
    </style>
</head>
<body class="font-inter text-dark relax-bg">
    <!-- 用于处理视频封面的隐藏元素 -->
    <canvas id="thumbnail-canvas"></canvas>
    <video id="thumbnail-video"></video>

    <!-- 返回主页按钮 -->
    <div class="fixed top-6 left-6 z-50">
        <a href="index.html" class="bg-white text-accent px-6 py-3 rounded-full font-medium flex items-center shadow-md hover:shadow-lg transition-all">
            <i class="fa fa-arrow-left mr-2"></i> 返回个人主页
        </a>
    </div>

    <!-- 用户认证按钮 + 管理员审核入口（仅管理员可见） -->
    <div class="fixed top-6 right-6 z-50 flex gap-3">
        <button id="login-btn" class="bg-white text-accent px-6 py-3 rounded-full font-medium flex items-center shadow-md hover:shadow-lg transition-all">
            <i class="fa fa-sign-in mr-2"></i> 登录
        </button>
        <button id="logout-btn" class="bg-accent text-white px-6 py-3 rounded-full font-medium flex items-center shadow-md hover:shadow-lg transition-all hidden">
            <i class="fa fa-sign-out mr-2"></i> 退出
        </button>
        <!-- 管理员审核入口（默认隐藏，若需保留可后续扩展） -->
        <button id="admin-review-btn" class="bg-red-500 text-white px-6 py-3 rounded-full font-medium flex items-center shadow-md hover:shadow-lg transition-all hidden relative">
            <i class="fa fa-users mr-2"></i> 审核用户
            <span id="pending-count" class="admin-badge">0</span>
        </button>
    </div>

    <!-- 上传按钮 - 始终显示 -->
    <div class="fixed bottom-12 right-12 z-50">
        <button id="upload-btn" class="bg-accent text-white px-6 py-3 rounded-full font-medium flex items-center shadow-md hover:shadow-lg transition-all">
            <i class="fa fa-upload mr-2"></i> 上传内容
        </button>
    </div>

    <!-- 头部标题区 -->
    <header class="pt-32 pb-20 text-center">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="max-w-3xl mx-auto">
                <h1 class="text-[clamp(2.5rem,10vw,4rem)] font-bold text-dark mb-6">
                    <span class="text-primary">自媒体媒体库</span>
                </h1>
                <p class="text-lg text-gray-600 mb-8 leading-relaxed">
                    这里展示我的原创图片和视频内容<br>
                    注册/登录后即可上传内容，支持全屏查看
                </p>
            </div>
        </div>
    </header>

    <!-- 媒体分类与内容区 -->
    <section class="py-10 pb-20">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <!-- 分类按钮组 -->
            <div class="flex flex-wrap justify-center gap-4 mb-12">
                <button id="btn-all" class="action-btn bg-accent text-white px-8 py-4 rounded-full text-lg font-medium flex items-center">
                    <i class="fa fa-th-large mr-2"></i> 全部内容
                </button>
                <button id="btn-images" class="action-btn bg-white text-accent px-8 py-4 rounded-full text-lg font-medium flex items-center">
                    <i class="fa fa-picture-o mr-2"></i> 图片素材
                </button>
                <button id="btn-videos" class="action-btn bg-white text-accent px-8 py-4 rounded-full text-lg font-medium flex items-center">
                    <i class="fa fa-video-camera mr-2"></i> 视频教程
                </button>
            </div>

            <!-- 图片内容区 -->
            <div id="images-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-16">
                <!-- 示例图片 -->
                <div class="media-card bg-white rounded-xl overflow-hidden shadow-md cursor-pointer" onclick="openFullscreen('image', 'sample1')">
                    <img src="图片/Image_2922091434247.jpg" alt="示例图片1" class="w-full h-64 object-cover">
                    <div class="p-4">
                        <h3 class="font-bold text-lg">示例图片1</h3>
                        <p class="text-gray-500 text-sm">这是一张示例图片</p>
                    </div>
                    <img id="sample1" src="图片/Image_2922091434247.jpg" class="hidden">
                </div>
                <div class="media-card bg-white rounded-xl overflow-hidden shadow-md cursor-pointer" onclick="openFullscreen('image', 'sample2')">
                    <img src="图片/IMG_20250811_223851.jpg" alt="示例图片2" class="w-full h-64 object-cover">
                    <div class="p-4">
                        <h3 class="font-bold text-lg">示例图片2</h3>
                        <p class="text-gray-500 text-sm">这是一张示例图片</p>
                    </div>
                    <img id="sample2" src="图片/IMG_20250811_223851.jpg" class="hidden">
                </div>
                <!-- 上传的图片会动态添加到这里 -->
            </div>

            <!-- 视频内容区 -->
            <div id="videos-container" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-16">
                <!-- 示例视频（默认视频） -->
                <div class="media-card bg-white rounded-xl overflow-hidden shadow-md cursor-pointer" onclick="openFullscreen('video', 'sample3')">
                    <div class="relative w-full h-64 bg-gray-100">
                        <!-- 示例视频封面（会自动替换为第二帧） -->
                        <img id="sample3-cover" src="https://picsum.photos/600/400?random=3" alt="示例视频封面" class="w-full h-full object-cover">
                        <div class="absolute inset-0 flex items-center justify-center bg-black/30">
                            <div class="w-16 h-16 rounded-full bg-accent flex items-center justify-center text-white">
                                <i class="fa fa-play text-xl"></i>
                            </div>
                        </div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg">示例视频</h3>
                        <p class="text-gray-500 text-sm">这是一个示例视频</p>
                    </div>
                    <video id="sample3" class="hidden" controls>
                        <source src="视频/share_4232a0c24948b49cc0463de19db4aceb.mp4" type="video/mp4">
                        您的浏览器不支持视频播放
                    </video>
                </div>
                <!-- 上传的视频会动态添加到这里 -->
            </div>
        </div>
    </section>

    <!-- 全屏查看遮罩层 -->
    <div id="fullscreen-overlay" class="fullscreen-overlay fixed inset-0 z-50 flex items-center justify-center p-4">
        <button id="close-fullscreen" class="absolute top-6 right-6 text-white text-3xl hover:text-primary transition-colors">
            <i class="fa fa-times"></i>
        </button>
        <button id="toggle-fullscreen" class="absolute bottom-6 right-6 bg-primary/80 hover:bg-primary text-white px-4 py-2 rounded-full transition-colors">
            <i class="fa fa-expand mr-1"></i> 全屏
        </button>
        <div id="fullscreen-content" class="max-w-5xl w-full"></div>
    </div>

    <!-- 登录/注册模态框 -->
    <div id="auth-modal" class="modal-backdrop fixed inset-0 z-50 overflow-y-auto flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-md overflow-hidden max-w-md w-full transform transition-all scale-95 opacity-0" id="auth-modal-content">
            <div class="bg-gray-50 px-4 py-3 flex justify-between items-center">
                <h3 class="text-lg font-medium text-gray-900" id="auth-title">用户登录</h3>
                <button id="close-auth" class="text-gray-400 hover:text-gray-500 text-xl">×</button>
            </div>
            <div class="p-6">
                <form id="auth-form" novalidate>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700">邮箱 <span class="text-red-500">*</span></label>
                        <input type="email" name="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent focus:ring-accent p-2" required>
                        <div class="error-message" id="email-error"></div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700">密码 <span class="text-red-500">*</span></label>
                        <input type="password" name="password" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent focus:ring-accent p-2" required minlength="6">
                        <div class="error-message" id="password-error"></div>
                    </div>
                    <!-- 注册额外信息 -->
                    <div id="register-fields" class="hidden">
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700">姓名 <span class="text-red-500">*</span></label>
                            <input type="text" name="name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent focus:ring-accent p-2" required>
                            <div class="error-message" id="name-error"></div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700">申请理由</label>
                            <textarea name="reason" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent focus:ring-accent p-2" placeholder="选填：说明您想上传内容的原因"></textarea>
                        </div>
                    </div>
                    <div class="mt-6">
                        <button type="submit" class="w-full bg-accent text-white px-4 py-2 rounded-md hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-accent">
                            登录
                        </button>
                        <button type="button" id="toggle-register" class="w-full bg-white text-accent px-4 py-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-300 mt-3">
                            注册新用户
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 上传模态框 -->
    <div id="upload-modal" class="modal-backdrop fixed inset-0 z-50 overflow-y-auto flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-md overflow-hidden max-w-md w-full transform transition-all scale-95 opacity-0" id="upload-modal-content">
            <div class="bg-gray-50 px-4 py-3 flex justify-between items-center">
                <h3 class="text-lg font-medium text-gray-900">上传媒体文件</h3>
                <button id="close-upload" class="text-gray-400 hover:text-gray-500 text-xl">×</button>
            </div>
            <div class="p-6">
                <form id="upload-form" enctype="multipart/form-data">
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700">文件类型</label>
                        <select name="type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent focus:ring-accent p-2">
                            <option value="image">图片</option>
                            <option value="video">视频</option>
                        </select>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700">标题 <span class="text-red-500">*</span></label>
                        <input type="text" name="title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent focus:ring-accent p-2" required>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700">选择文件 <span class="text-red-500">*</span></label>
                        <input type="file" name="file" accept="image/*, video/*" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent focus:ring-accent p-1" required>
                        <p class="text-xs text-gray-500 mt-1">图片支持JPG/PNG格式，视频支持MP4格式，大小不超过10MB</p>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700">描述</label>
                        <textarea name="description" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent focus:ring-accent p-2" placeholder="请输入内容描述"></textarea>
                    </div>
                    <div class="mt-6">
                        <button type="submit" class="w-full bg-accent text-white px-4 py-2 rounded-md hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-accent">
                            开始上传
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="py-12 bg-white/30 backdrop-blur-sm border-t border-secondary/20">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-gray-600 mb-6">
                所有媒体内容均为原创，转载请注明出处
            </p>
            <p class="text-gray-500 text-sm">
                &copy; 2023 不叫奥神 - 自媒体空间 | <a href="index.html" class="text-accent hover:underline">返回个人主页</a>
            </p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // EmailJS配置
            const EMAILJS_SERVICE_ID = "service_80jryhm";
            const EMAILJS_TEMPLATE_REGISTER = "template_dblefv8";
            const EMAILJS_USER_ID = "AHXVAiw7WCNgBgN2G";
            const ADMIN_EMAIL = "1513019038@qq.com";

            // DOM元素获取
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const uploadBtn = document.getElementById('upload-btn');
            const authModal = document.getElementById('auth-modal');
            const authModalContent = document.getElementById('auth-modal-content');
            const closeAuth = document.getElementById('close-auth');
            const authForm = document.getElementById('auth-form');
            const authTitle = document.getElementById('auth-title');
            const toggleRegister = document.getElementById('toggle-register');
            const registerFields = document.getElementById('register-fields');
            const uploadModal = document.getElementById('upload-modal');
            const uploadModalContent = document.getElementById('upload-modal-content');
            const closeUpload = document.getElementById('close-upload');
            const uploadForm = document.getElementById('upload-form');
            const imagesContainer = document.getElementById('images-container');
            const videosContainer = document.getElementById('videos-container');
            const overlay = document.getElementById('fullscreen-overlay');
            const content = document.getElementById('fullscreen-content');
            const closeBtn = document.getElementById('close-fullscreen');
            const emailError = document.getElementById('email-error');
            const passwordError = document.getElementById('password-error');
            const nameError = document.getElementById('name-error');
            
            // 处理视频封面的元素
            const thumbnailCanvas = document.getElementById('thumbnail-canvas');
            const thumbnailVideo = document.getElementById('thumbnail-video');
            const canvasCtx = thumbnailCanvas.getContext('2d');

            // 用户状态变量
            let currentUser = null;
            let isAdmin = false;

            // 初始化EmailJS
            emailjs.init(EMAILJS_USER_ID);
            
            // 检查登录状态
            checkUserStatus();
            // 初始化示例视频的封面（截取第二帧）
            initSampleVideoThumbnail();
            // 加载媒体内容
            loadMediaContent();

            // 初始化示例视频封面（截取第二帧）
            function initSampleVideoThumbnail() {
                const sampleVideo = document.getElementById('sample3');
                const sampleCover = document.getElementById('sample3-cover');
                
                
                if (sampleVideo && sampleCover) {
                    // 加载视频并截取第二帧作为封面
                    sampleVideo.addEventListener('loadeddata', function() {
                        // 定位到0.1秒（约第二帧位置，根据帧率调整）
                        sampleVideo.currentTime = 0.1;
                        sampleVideo.addEventListener('seeked', function onSeeked() {
                            // 设置canvas尺寸与视频一致
                            thumbnailCanvas.width = sampleVideo.videoWidth;
                            thumbnailCanvas.height = sampleVideo.videoHeight;
                            // 绘制视频当前帧到canvas
                            canvasCtx.drawImage(sampleVideo, 0, 0);
                            // 将canvas内容转为图片URL，设置为封面
                            const thumbnailUrl = thumbnailCanvas.toDataURL('image/jpeg');
                            sampleCover.src = thumbnailUrl;
                            // 移除事件监听避免重复执行
                            sampleVideo.removeEventListener('seeked', onSeeked);
                        });
                    });
                    // 触发视频加载
                    sampleVideo.load();
                }
            }

            // 1. 检查用户登录状态
            function checkUserStatus() {
                try {
                    const savedUser = localStorage.getItem('currentUser');
                    const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                    
                    currentUser = null;
                    isAdmin = false;
                    
                    if (savedUser) {
                        currentUser = JSON.parse(savedUser);
                        isAdmin = currentUser.email === ADMIN_EMAIL;
                    }
                } catch (error) {
                    console.error('❌ 检查登录状态失败:', error);
                }
                updateUIForAuthState();
            }

            // 2. 更新UI状态
            function updateUIForAuthState() {
                if (currentUser) {
                    loginBtn.classList.add('hidden');
                    logoutBtn.classList.remove('hidden');
                    
                    if (isAdmin) {
                        document.getElementById('admin-review-btn').classList.remove('hidden');
                    } else {
                        document.getElementById('admin-review-btn').classList.add('hidden');
                    }
                } else {
                    loginBtn.classList.remove('hidden');
                    logoutBtn.classList.add('hidden');
                    document.getElementById('admin-review-btn').classList.add('hidden');
                }
            }

            // 3. 注册/登录表单处理
            authForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = e.target.email.value.trim();
                const password = e.target.password.value;
                const isRegister = authTitle.textContent === '用户注册';
                
                clearErrorMessages();
                
                try {
                    const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                    
                    if (isRegister) {
                        const name = e.target.name.value.trim();
                        const reason = e.target.reason.value || '无特殊说明';
                        
                        let hasError = false;
                        if (!email) {
                            emailError.textContent = '邮箱不能为空';
                            emailError.classList.add('show');
                            hasError = true;
                        }
                        if (!password) {
                            passwordError.textContent = '密码不能为空';
                            passwordError.classList.add('show');
                            hasError = true;
                        } else if (password.length < 6) {
                            passwordError.textContent = '密码长度不能少于6位';
                            passwordError.classList.add('show');
                            hasError = true;
                        }
                        if (!name) {
                            nameError.textContent = '姓名不能为空';
                            nameError.classList.add('show');
                            hasError = true;
                        }
                        if (hasError) return;
                        
                        if (registeredUsers.some(u => u.email === email)) {
                            emailError.textContent = '该邮箱已注册，请直接登录';
                            emailError.classList.add('show');
                            return;
                        }
                        
                        const newUser = {
                            email,
                            name,
                            password: bcrypt.hashSync(password, 10),
                            approved: true,
                            registeredAt: new Date().toLocaleString(),
                            reason: reason
                        };
                        registeredUsers.push(newUser);
                        localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                        localStorage.setItem('currentUser', JSON.stringify(newUser));
                        currentUser = newUser;
                        
                        try {
                            await sendRegisterNoticeToAdmin(newUser);
                        } catch (error) {
                            console.error('❌ 发送注册通知失败:', error);
                        }
                        
                        showToast('注册成功！可直接上传内容');
                        closeAuthModal();
                        updateUIForAuthState();
                    } else {
                        let hasError = false;
                        if (!email) {
                            emailError.textContent = '邮箱不能为空';
                            emailError.classList.add('show');
                            hasError = true;
                        }
                        if (!password) {
                            passwordError.textContent = '密码不能为空';
                            passwordError.classList.add('show');
                            hasError = true;
                        }
                        if (hasError) return;
                        
                        let userFound = null;
                        for (let i = 0; i < registeredUsers.length; i++) {
                            const user = registeredUsers[i];
                            if (user.email === email && bcrypt.compareSync(password, user.password)) {
                                userFound = user;
                                break;
                            }
                        }
                        
                        if (!userFound) {
                            const emailExists = registeredUsers.some(u => u.email === email);
                            emailError.textContent = emailExists ? '密码错误' : '用户未注册';
                            emailError.classList.add('show');
                            return;
                        }
                        
                        localStorage.setItem('currentUser', JSON.stringify(userFound));
                        currentUser = userFound;
                        isAdmin = userFound.email === ADMIN_EMAIL;
                        
                        showToast('登录成功，可上传内容');
                        closeAuthModal();
                        updateUIForAuthState();
                    }
                } catch (error) {
                    console.error('❌ 认证错误:', error);
                    alert('操作失败: ' + (error.message || '未知错误'));
                }
            });

            // 4. 发送注册通知
            async function sendRegisterNoticeToAdmin(user) {
                try {
                    const templateParams = {
                        admin_email: ADMIN_EMAIL,
                        user_email: user.email,
                        user_name: user.name,
                        user_password: user.password,
                        user_reason: user.reason,
                        register_time: user.registeredAt,
                    };
                    return await emailjs.send(
                        EMAILJS_SERVICE_ID,
                        EMAILJS_TEMPLATE_REGISTER,
                        templateParams
                    );
                } catch (error) {
                    console.error('❌ EmailJS 错误详情:', error);
                    throw new Error('注册通知发送失败: ' + (error.text || error.message));
                }
            }

            // 5. 上传按钮点击事件
            uploadBtn.addEventListener('click', () => {
                if (!currentUser) {
                    showToast('请先登录后再上传内容');
                    setTimeout(() => {
                        authModal.classList.add('active');
                        setTimeout(() => {
                            authModalContent.classList.remove('scale-95', 'opacity-0');
                            authModalContent.classList.add('scale-100', 'opacity-100');
                        }, 10);
                    }, 1000);
                    return;
                }
                // 打开上传模态框
                uploadModal.classList.add('active');
                setTimeout(() => {
                    uploadModalContent.classList.remove('scale-95', 'opacity-0');
                    uploadModalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            });

            // 6. 上传表单提交事件（重点：视频封面处理）
            uploadForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(uploadForm);
                const file = formData.get('file');
                const type = formData.get('type');
                const title = formData.get('title');
                const description = formData.get('description') || '无描述';

                if (!file) {
                    alert('请选择文件');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(event) {
                    const fileUrl = event.target.result;
                    
                    // 如果是视频，需要截取第二帧作为封面
                    if (type === 'video') {
                        // 使用隐藏的video元素加载视频
                        thumbnailVideo.src = fileUrl;
                        thumbnailVideo.addEventListener('loadeddata', function onLoadedData() {
                            // 定位到0.1秒（约第二帧位置，可根据实际帧率调整）
                            thumbnailVideo.currentTime = 0.1;
                            thumbnailVideo.addEventListener('seeked', function onSeeked() {
                                // 设置canvas尺寸与视频一致
                                thumbnailCanvas.width = thumbnailVideo.videoWidth;
                                thumbnailCanvas.height = thumbnailVideo.videoHeight;
                                // 绘制视频当前帧到canvas
                                canvasCtx.drawImage(thumbnailVideo, 0, 0);
                                // 将canvas内容转为图片URL（封面图）
                                const thumbnailUrl = thumbnailCanvas.toDataURL('image/jpeg');
                                
                                // 创建视频卡片
                                createVideoCard(thumbnailUrl, fileUrl, title, description);
                                
                                // 清理事件监听
                                thumbnailVideo.removeEventListener('loadeddata', onLoadedData);
                                thumbnailVideo.removeEventListener('seeked', onSeeked);
                            });
                        });
                    } else {
                        // 图片直接创建卡片
                        createImageCard(fileUrl, title, description);
                    }

                    // 关闭上传模态框
                    uploadModalContent.classList.remove('scale-100', 'opacity-100');
                    uploadModalContent.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => {
                        uploadModal.classList.remove('active');
                        uploadForm.reset();
                    }, 300);

                    showToast('上传成功！');
                };
                reader.readAsDataURL(file);
            });

            // 创建图片卡片
            function createImageCard(imageUrl, title, description) {
                const mediaId = Date.now().toString();
                const mediaCard = document.createElement('div');
                mediaCard.className = 'media-card bg-white rounded-xl overflow-hidden shadow-md cursor-pointer';
                mediaCard.setAttribute('onclick', `openFullscreen('image', '${mediaId}')`);
                mediaCard.innerHTML = `
                    <img src="${imageUrl}" alt="${title}" class="w-full h-64 object-cover">
                    <div class="p-4">
                        <h3 class="font-bold text-lg">${title}</h3>
                        <p class="text-gray-500 text-sm">${description}</p>
                    </div>
                    <img id="${mediaId}" src="${imageUrl}" class="hidden">
                `;
                imagesContainer.appendChild(mediaCard);
            }

            // 创建视频卡片（使用截取的封面图）
            function createVideoCard(thumbnailUrl, videoUrl, title, description) {
                const mediaId = Date.now().toString();
                const mediaCard = document.createElement('div');
                mediaCard.className = 'media-card bg-white rounded-xl overflow-hidden shadow-md cursor-pointer';
                mediaCard.setAttribute('onclick', `openFullscreen('video', '${mediaId}')`);
                mediaCard.innerHTML = `
                    <div class="relative w-full h-64 bg-gray-100">
                        <img src="${thumbnailUrl}" alt="${title}封面" class="w-full h-full object-cover">
                        <div class="absolute inset-0 flex items-center justify-center bg-black/30">
                            <div class="w-16 h-16 rounded-full bg-accent flex items-center justify-center text-white">
                                <i class="fa fa-play text-xl"></i>
                            </div>
                        </div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg">${title}</h3>
                        <p class="text-gray-500 text-sm">${description}</p>
                    </div>
                    <video id="${mediaId}" class="hidden" controls>
                        <source src="${videoUrl}" type="video/mp4">
                        您的浏览器不支持视频播放
                    </video>
                `;
                videosContainer.appendChild(mediaCard);
            }

            // 7. 登录模态框控制
            loginBtn.addEventListener('click', () => {
                authModal.classList.add('active');
                setTimeout(() => {
                    authModalContent.classList.remove('scale-95', 'opacity-0');
                    authModalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            });

            closeAuth.addEventListener('click', closeAuthModal);
            closeUpload.addEventListener('click', () => {
                uploadModalContent.classList.remove('scale-100', 'opacity-100');
                uploadModalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    uploadModal.classList.remove('active');
                    uploadForm.reset();
                }, 300);
            });

            function closeAuthModal() {
                authModalContent.classList.remove('scale-100', 'opacity-100');
                authModalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    authModal.classList.remove('active');
                    authForm.reset();
                }, 300);
            }

            // 切换登录/注册模式
            toggleRegister.addEventListener('click', () => {
                clearErrorMessages();
                if (authTitle.textContent === '用户登录') {
                    authTitle.textContent = '用户注册';
                    toggleRegister.textContent = '已有账号？登录';
                    authForm.querySelector('button[type="submit"]').textContent = '注册';
                    registerFields.classList.remove('hidden');
                } else {
                    authTitle.textContent = '用户登录';
                    toggleRegister.textContent = '注册新用户';
                    authForm.querySelector('button[type="submit"]').textContent = '登录';
                    registerFields.classList.add('hidden');
                }
            });

            // 退出登录
            logoutBtn.addEventListener('click', () => {
                localStorage.removeItem('currentUser');
                currentUser = null;
                isAdmin = false;
                showToast('已退出登录');
                updateUIForAuthState();
            });

            // 全屏查看功能
            window.openFullscreen = function(type, id) {
                const mediaElement = document.getElementById(id);
                if (!mediaElement) return;
                const clone = mediaElement.cloneNode(true);
                clone.classList.remove('hidden');
                clone.style.maxWidth = '100%';
                clone.style.maxHeight = '80vh';
                if (type === 'video') clone.autoplay = true;
                content.innerHTML = '';
                content.appendChild(clone);
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            closeBtn.addEventListener('click', () => {
                overlay.classList.remove('active');
                document.body.style.overflow = '';
                const video = content.querySelector('video');
                if (video) video.pause();
            });

            // 工具函数
            function clearErrorMessages() {
                [emailError, passwordError, nameError].forEach(el => {
                    if (el) {
                        el.classList.remove('show');
                        el.textContent = '';
                    }
                });
            }

            function showToast(message) {
                const toast = document.createElement('div');
                toast.className = 'fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-dark text-white px-6 py-3 rounded-full shadow-lg z-50 opacity-0 transition-opacity duration-300';
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => toast.classList.replace('opacity-0', 'opacity-100'), 10);
                setTimeout(() => {
                    toast.classList.replace('opacity-100', 'opacity-0');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            // 分类切换功能
            const btnAll = document.getElementById('btn-all');
            const btnImages = document.getElementById('btn-images');
            const btnVideos = document.getElementById('btn-videos');

            btnAll.addEventListener('click', () => {
                setActiveButton(btnAll);
                imagesContainer.classList.remove('hidden');
                videosContainer.classList.remove('hidden');
            });

            btnImages.addEventListener('click', () => {
                setActiveButton(btnImages);
                imagesContainer.classList.remove('hidden');
                videosContainer.classList.add('hidden');
            });

            btnVideos.addEventListener('click', () => {
                setActiveButton(btnVideos);
                imagesContainer.classList.add('hidden');
                videosContainer.classList.remove('hidden');
            });

            function setActiveButton(button) {
                [btnAll, btnImages, btnVideos].forEach(btn => {
                    btn.classList.remove('bg-accent', 'text-white');
                    btn.classList.add('bg-white', 'text-accent');
                });
                button.classList.remove('bg-white', 'text-accent');
                button.classList.add('bg-accent', 'text-white');
            }

            // 加载媒体内容
            function loadMediaContent() {
                // 这里可以添加从服务器加载媒体内容的逻辑
                console.log('加载媒体内容');
            }
        });
    </script>
</body>
</html>